import{p as R,d as E,s as I}from"./styles-0dd3ba1e.1fba1741.js";import{C as p,v as a,B as S,T as $,P as z,N as A,K as _,L as P,G as M}from"../app.72c6b1ee.js";import{G as q}from"./layout.617340ac.js";import{r as F}from"./index-f9d09cc9.f4e49ec5.js";import"./isPlainObject.69ae982a.js";import"./edges-65da65dc.dd380f03.js";import"./svgDraw-6a237a99.eb3c95f3.js";const B=s=>M.sanitizeText(s,a());let T={dividerMargin:10,padding:5,textHeight:10,curve:void 0};const H=function(s,o,h,n){const e=Object.keys(s);p.info("keys:",e),p.info(s),e.forEach(function(i){var f,u;var l,r;const t=s[i];let y="";t.cssClasses.length>0&&(y=y+" "+t.cssClasses.join(" "));const c={labelStyle:"",style:""},m=(f=t.label)!=null?f:t.id,d=0,v="class_box",b={labelStyle:c.labelStyle,shape:v,labelText:B(m),classData:t,rx:d,ry:d,class:y,style:c.style,id:t.id,domId:t.domId,tooltip:n.db.getTooltip(t.id)||"",haveCallback:t.haveCallback,link:t.link,width:t.type==="group"?500:void 0,type:t.type,padding:(u=(l=a().flowchart)==null?void 0:l.padding)!=null?u:(r=a().class)==null?void 0:r.padding};o.setNode(t.id,b),p.info("setNode",b)})},K=function(s,o,h,n){p.info(s),s.forEach(function(e,i){var g;var l,r;const t=e,y="",c={labelStyle:"",style:""},m=t.text,d=0,v="note",b={labelStyle:c.labelStyle,shape:v,labelText:B(m),noteData:t,rx:d,ry:d,class:y,style:c.style,id:t.id,domId:t.id,tooltip:"",type:"note",padding:(g=(l=a().flowchart)==null?void 0:l.padding)!=null?g:(r=a().class)==null?void 0:r.padding};if(o.setNode(t.id,b),p.info("setNode",b),!t.class||!(t.class in n))return;const f=h+i,u={id:`edgeNote${f}`,classes:"relation",pattern:"dotted",arrowhead:"none",startLabelRight:"",endLabelLeft:"",arrowTypeStart:"none",arrowTypeEnd:"none",style:"fill:none",labelStyle:"",curve:A(T.curve,_)};o.setEdge(t.id,t.class,u,f)})},V=function(s,o){const h=a().flowchart;let n=0;s.forEach(function(e){var r;var i;n++;const l={classes:"relation",pattern:e.relation.lineType==1?"dashed":"solid",id:"id"+n,arrowhead:e.type==="arrow_open"?"none":"normal",startLabelRight:e.relationTitle1==="none"?"":e.relationTitle1,endLabelLeft:e.relationTitle2==="none"?"":e.relationTitle2,arrowTypeStart:N(e.relation.type1),arrowTypeEnd:N(e.relation.type2),style:"fill:none",labelStyle:"",curve:A(h==null?void 0:h.curve,_)};if(p.info(l,e),e.style!==void 0){const t=P(e.style);l.style=t.style,l.labelStyle=t.labelStyle}e.text=e.title,e.text===void 0?e.style!==void 0&&(l.arrowheadStyle="fill: #333"):(l.arrowheadStyle="fill: #333",l.labelpos="c",((r=(i=a().flowchart)==null?void 0:i.htmlLabels)!=null?r:a().htmlLabels)?(l.labelType="html",l.label='<span class="edgeLabel">'+e.text+"</span>"):(l.labelType="text",l.label=e.text.replace(M.lineBreakRegex,`
`),e.style===void 0&&(l.style=l.style||"stroke: #333; stroke-width: 1.5px;fill:none"),l.labelStyle=l.labelStyle.replace("color:","fill:"))),o.setEdge(e.id1,e.id2,l,n)})},W=function(s){T={...T,...s}},J=function(s,o,h,n){var u,g,k,L;p.info("Drawing class - ",o);const e=(u=a().flowchart)!=null?u:a().class,i=a().securityLevel;p.info("config:",e);const l=(g=e==null?void 0:e.nodeSpacing)!=null?g:50,r=(k=e==null?void 0:e.rankSpacing)!=null?k:50,t=new q({multigraph:!0,compound:!0}).setGraph({rankdir:n.db.getDirection(),nodesep:l,ranksep:r,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}}),y=n.db.getClasses(),c=n.db.getRelations(),m=n.db.getNotes();p.info(c),H(y,t,o,n),V(c,t),K(m,t,c.length+1,y);let d;i==="sandbox"&&(d=S("#i"+o));const v=i==="sandbox"?S(d.nodes()[0].contentDocument.body):S("body"),b=v.select(`[id="${o}"]`),f=v.select("#"+o+" g");if(F(f,t,["aggregation","extension","composition","dependency","lollipop"],"classDiagram",o),$.insertTitle(b,"classTitleText",(L=e==null?void 0:e.titleTopMargin)!=null?L:5,n.db.getDiagramTitle()),z(t,b,e==null?void 0:e.diagramPadding,e==null?void 0:e.useMaxWidth),!(e!=null&&e.htmlLabels)){const C=i==="sandbox"?d.nodes()[0].contentDocument:document,G=C.querySelectorAll('[id="'+o+'"] .edgeLabel .label');for(const w of G){const D=w.getBBox(),x=C.createElementNS("http://www.w3.org/2000/svg","rect");x.setAttribute("rx",0),x.setAttribute("ry",0),x.setAttribute("width",D.width),x.setAttribute("height",D.height),w.insertBefore(x,w.firstChild)}}};function N(s){let o;switch(s){case 0:o="aggregation";break;case 1:o="extension";break;case 2:o="composition";break;case 3:o="dependency";break;case 4:o="lollipop";break;default:o="none"}return o}const Q={setConf:W,draw:J},te={parser:R,db:E,renderer:Q,styles:I,init:s=>{s.class||(s.class={}),s.class.arrowMarkerAbsolute=s.arrowMarkerAbsolute,E.clear()}};export{te as diagram};
